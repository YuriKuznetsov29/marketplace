generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         String       @id @default(uuid())
  name       String
  email      String       @unique
  password   String
  phone      String?
  role       Role         @default(USER)
  createdAt  DateTime     @default(now())
  provider   String?
  providerId String?
  chats      ChatMember[]
  favorites  Favorite[]
  listings   Listing[]
  message    Message[]
  reports    Report[]     @relation("UserReports")
}

model Listing {
  id          String      @id @default(uuid())
  title       String
  description String
  price       Int
  mileage     Int
  fuelType    FuelType
  gearbox     GearboxType
  images      String[]
  sellerId    String
  brandId     String
  modelId     String
  cityId      Int
  createdAt   DateTime    @default(now())
  year        Int
  favorites   Favorite[]
  brand       Brand       @relation(fields: [brandId], references: [id])
  city        City        @relation(fields: [cityId], references: [id])
  model       Model       @relation(fields: [modelId], references: [id])
  seller      User        @relation(fields: [sellerId], references: [id])
  reports     Report[]
}

model Favorite {
  id        String   @id @default(uuid())
  userId    String
  listingId String
  createdAt DateTime @default(now())
  listing   Listing  @relation(fields: [listingId], references: [id])
  user      User     @relation(fields: [userId], references: [id])
}

model Report {
  id         String       @id @default(uuid())
  reporterId String
  listingId  String?
  reason     String
  status     ReportStatus @default(PENDING)
  createdAt  DateTime     @default(now())
  listing    Listing?     @relation(fields: [listingId], references: [id])
  reporter   User         @relation("UserReports", fields: [reporterId], references: [id])
}

model Brand {
  id       String    @id @default(uuid())
  name     String
  listings Listing[]
  models   Model[]
}

model Model {
  id       String    @id @default(uuid())
  name     String
  brandId  String
  listings Listing[]
  brand    Brand     @relation(fields: [brandId], references: [id])
}

model City {
  id              Int       @id @default(autoincrement())
  address         String?
  postalCode      String?
  country         String?
  federalDistrict String?
  regionType      String?
  region          String?
  areaType        String?
  area            String?
  cityType        String?
  city            String?
  settlementType  String?
  settlement      String?
  kladrId         String?
  fiasId          String?
  fiasLevel       Int?
  capitalMarker   Int?
  okato           String?
  oktmo           String?
  taxOffice       String?
  timezone        String?
  geoLat          Float?
  geoLon          Float?
  population      Int?
  foundationYear  Int?
  listings        Listing[]
}

model Chat {
  id        String       @id @default(uuid())
  name      String?
  createdAt DateTime     @default(now())
  members   ChatMember[]
  messages  Message[]
}

model ChatMember {
  id     String @id @default(uuid())
  chatId String
  userId String
  chat   Chat   @relation(fields: [chatId], references: [id])
  user   User   @relation(fields: [userId], references: [id])
}

model Message {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  chatId    String
  text      String
  userId    String?
  chat      Chat     @relation(fields: [chatId], references: [id])
  User      User?    @relation(fields: [userId], references: [id])
}

enum Role {
  USER
  ADMIN
}

enum FuelType {
  GASOLINE
  DIESEL
  ELECTRIC
  HYBRID
}

enum GearboxType {
  MANUAL
  AUTOMATIC
}

enum ReportStatus {
  PENDING
  REVIEWED
  REJECTED
}
